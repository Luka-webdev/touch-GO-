const wrapperWelcomeScreen=document.querySelector(".wrapperWelcomeScreen"),wrapperAreaGame=document.querySelector(".wrapperAreaGame"),areaGame=document.querySelector(".areaGame"),closeWelcomeScreen=document.querySelector(".fa-window-close"),continueGame=document.querySelector(".continueGame"),trackWin=document.querySelector(".trackWin"),gameWin=document.querySelector(".gameWin"),continueGameBtn=document.querySelector(".fa-arrow-circle-right"),wrapperTracks=document.querySelector(".wrapperTracks"),ball=document.querySelector(".ball"),counter=document.querySelector(".counter"),tryAgain=document.querySelector(".fa-undo-alt"),totalTime=document.querySelector(".totalTime"),totalMistakes=document.querySelector(".totalMistakes"),tracksArray=[track1,track2,track3,track4,track5,track6,track7,track8,track9,track10,track11,track12,track13,track14,track15];let flag=!1,startTiming=0,totalMistakesSum=0,totalTimesSum=0,dimensionsAreaGame=getComputedStyle(areaGame),size=.5,actualTrack=0,ratioWidthToHeight=(window.innerWidth/window.innerHeight).toFixed(1);1.3==ratioWidthToHeight&&(areaGame.style.width="100vw"),2.1<ratioWidthToHeight&&(areaGame.style.height="95vh");const settings={shiftX:parseInt(dimensionsAreaGame.marginLeft),shiftY:parseInt(dimensionsAreaGame.marginTop),heightTrackElement:parseInt(dimensionsAreaGame.height)/7,widthTrackElement:parseInt(dimensionsAreaGame.width)/12,ballSize:parseInt(dimensionsAreaGame.height)/7*size},showAreaGame=function(){wrapperAreaGame.classList.remove("visibility"),createTrack(),counter.textContent=`${Math.ceil(tracksArray[actualTrack].layout.length/3).toFixed(2)}`},createTrackBox=function(e,t){const a=document.createElement("div");a.classList.add("trackBox"),"ready"==e?(a.style.backgroundImage="url(pictures/picture"+actualTrack+".png)",a.addEventListener("click",showAreaGame)):"blocked"==e?a.innerHTML='<i class = "fas fa-lock" ></i>':"done"==e&&(a.style.backgroundImage="url(pictures/picture"+t+".png)",a.innerHTML='<i class="fas fa-check"></i>'),wrapperTracks.appendChild(a)},showAllTracks=function(){for(let e=0;e<tracksArray.length;e++)"ready"==tracksArray[e].status?createTrackBox("ready"):"blocked"==tracksArray[e].status?createTrackBox("blocked"):"done"==tracksArray[e].status&&createTrackBox("done",e)};showAllTracks();const createTrackElement=function(e,t){const a=document.createElement("div");a.classList.add("trackItem"),a.style.gridColumn=e,a.style.gridRow=t,areaGame.appendChild(a)},createTrack=function(){for(let e=0;e<tracksArray[actualTrack].layout.length;e++)createTrackElement(tracksArray[actualTrack].layout[e].column,tracksArray[actualTrack].layout[e].row);createBall()},createBall=function(){ball.style.width=settings.ballSize+"px",ball.style.height=settings.ballSize+"px",ball.style.left="0px",ball.style.top=settings.heightTrackElement*(tracksArray[actualTrack].layout[0].row-1)+settings.heightTrackElement/2-settings.ballSize/2+"px"},timing=function(){let e=Math.ceil(tracksArray[actualTrack].layout.length/3);1==startTiming&&(interval=setInterval(()=>{counter.textContent=`${e.toFixed(2)}`,e-=.01,e<0&&(clearInterval(interval),gameOver())},10))},countingTimes=function(){var e=Math.ceil(tracksArray[actualTrack].layout.length/3)-counter.textContent;totalTimesSum+=e},gameOver=function(){flag=!1,startTiming=0,totalMistakesSum++,clearInterval(interval),setTimeout(()=>{continueGame.classList.remove("visibility")},500)},gameOverConditions=function(e){var t=actualColumn*settings.widthTrackElement,a=(actualColumn-1)*settings.widthTrackElement,r=actualRow*settings.heightTrackElement,l=(actualRow-1)*settings.heightTrackElement;switch(e){case"horizontal":(ballCenterY+settings.ballSize/2>r||ballCenterY-settings.ballSize/2<l)&&gameOver();break;case"vertical":(ballCenterX-settings.ballSize/2<a||ballCenterX+settings.ballSize/2>t)&&gameOver();break;case"top-right":(ballCenterX+settings.ballSize/2>t||ballCenterY-settings.ballSize/2<l)&&gameOver();break;case"bottom-left":(ballCenterX-settings.ballSize/2<a||ballCenterY+settings.ballSize/2>r)&&gameOver();break;case"bottom-right":(ballCenterX+settings.ballSize/2>t||ballCenterY+settings.ballSize/2>r)&&gameOver();break;case"top-left":(ballCenterX-settings.ballSize/2<a||ballCenterY-settings.ballSize/2<l)&&gameOver()}},recognizeTrackElement=function(){ballCenterX=parseInt(ball.style.left)+settings.ballSize/2,ballCenterY=parseInt(ball.style.top)+settings.ballSize/2,actualColumn=Math.ceil(ballCenterX/settings.widthTrackElement),actualRow=Math.ceil(ballCenterY/settings.heightTrackElement);for(let e=0;e<tracksArray[actualTrack].layout.length;e++){var t;tracksArray[actualTrack].layout[e].column==actualColumn&&tracksArray[actualTrack].layout[e].row==actualRow&&(t=tracksArray[actualTrack].layout[e].direction,gameOverConditions(t))}},removeTracksBoxes=function(){var t=wrapperTracks.querySelectorAll("div");for(let e=0;e<t.length;e++)wrapperTracks.removeChild(t[e])},removeTrack=function(){var t=areaGame.querySelectorAll(".trackItem");for(let e=0;e<t.length;e++)areaGame.removeChild(t[e])},trackCrossing=function(){parseInt(ball.style.left)+settings.ballSize>=parseInt(dimensionsAreaGame.width)&&(flag=!1,startTiming=0,countingTimes(),clearInterval(interval),setTimeout(()=>{actualTrack==tracksArray.length-1?(totalMistakes.textContent=`Łączna ilość błędów: ${totalMistakesSum}`,totalTime.textContent=`Łączny czas przejścia wszystkich labiryntów: ${totalTimesSum.toFixed(2)} s`,gameWin.classList.remove("visibility")):trackWin.classList.remove("visibility")},500),setTimeout(()=>{actualTrack!=tracksArray.length-1&&(trackWin.classList.add("visibility"),wrapperAreaGame.classList.add("visibility"),tracksArray[actualTrack].status="done",removeTracksBoxes(),removeTrack(),actualTrack++,settings.ballSize+=1,tracksArray[actualTrack].status="ready",showAllTracks())},3e3))},moveBall=function(e,t){flag&&(1==t?(ball.style.top=e.touches[0].clientY-settings.shiftY-settings.ballSize/2+"px",ball.style.left=e.touches[0].clientX-settings.shiftX-settings.ballSize/2+"px"):(ball.style.top=e.clientY-settings.shiftY-offsetY+"px",ball.style.left=e.clientX-settings.shiftX-offsetX+"px"),ball.style.left<"0px"&&(ball.style.left="0px"),recognizeTrackElement(),trackCrossing())},getOffsetProperty=function(e,t){continueGame.classList.contains("visibility")&&gameWin.classList.contains("visibility")&&trackWin.classList.contains("visibility")&&(flag=!0,startTiming++,timing(),1!=t&&(offsetX=e.offsetX,offsetY=e.offsetY))};ball.addEventListener("mousedown",function(e){getOffsetProperty(e,!1)}),ball.addEventListener("touchstart",function(e){getOffsetProperty(e,!0)}),ball.addEventListener("mouseup",function(){flag=!1}),ball.addEventListener("touchend",function(){flag=!1}),areaGame.addEventListener("mousemove",function(e){moveBall(e,!1)}),areaGame.addEventListener("touchmove",function(e){moveBall(e,!0)}),closeWelcomeScreen.addEventListener("click",function(){wrapperWelcomeScreen.classList.add("visibility")}),continueGameBtn.addEventListener("click",function(){continueGame.classList.add("visibility"),removeTrack(),showAreaGame()}),tryAgain.addEventListener("click",function(){gameWin.classList.add("visibility"),wrapperAreaGame.classList.add("visibility"),removeTrack(),removeTracksBoxes(),settings.ballSize=parseInt(dimensionsAreaGame.height)/7*size,actualTrack=0,totalMistakesSum=0;for(let e=totalTimesSum=0;e<tracksArray.length;e++)0==e?tracksArray[e].status="ready":tracksArray[e].status="blocked";showAllTracks()});